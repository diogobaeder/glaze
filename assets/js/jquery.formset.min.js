!function(a){a.fn.formset=function(b){var c=a.extend({},a.fn.formset.defaults,b),d=c.extraClasses.join(" "),e=a("#id_"+c.prefix+"-TOTAL_FORMS"),f=a("#id_"+c.prefix+"-MAX_NUM_FORMS"),g=a("#id_"+c.prefix+"-MIN_NUM_FORMS"),h="input,select,textarea,label,div",i=a(this),j=function(a,b){c.extraClasses&&(a.removeClass(d),a.addClass(c.extraClasses[b%c.extraClasses.length]))},k=function(a,b,c){var d=new RegExp(b+"-(\\d+|__prefix__)-"),e=b+"-"+c+"-";a.attr("for")&&a.attr("for",a.attr("for").replace(d,e)),a.attr("id")&&a.attr("id",a.attr("id").replace(d,e)),a.attr("name")&&a.attr("name",a.attr("name").replace(d,e))},l=function(a){return a.find(h).length>0},m=function(){return 0==f.length||""==f.val()||f.val()-e.val()>0},n=function(){return 0==g.length||""==g.val()||e.val()-g.val()>0},o=function(b){var d=a.trim(c.deleteCssClass).replace(/\s+/g,"."),f=a.trim(c.addCssClass).replace(/\s+/g,".");b.is("TR")?b.children(":last").append('<a class="'+c.deleteCssClass+'" href="javascript:void(0)">'+c.deleteText+"</a>"):b.is("UL")||b.is("OL")?b.append('<li><a class="'+c.deleteCssClass+'" href="javascript:void(0)">'+c.deleteText+"</a></li>"):b.append('<a class="'+c.deleteCssClass+'" href="javascript:void(0)">'+c.deleteText+"</a>"),n()||b.find("a."+d).hide(),b.find("a."+d).click(function(){var l,b=a(this).parents("."+c.formCssClass),g=b.find('input:hidden[id $= "-DELETE"]'),i=b.siblings("a."+f+", ."+c.formCssClass+"-add");g.length?(g.val("on"),b.hide(),l=a("."+c.formCssClass).not(":hidden")):(b.remove(),l=a("."+c.formCssClass).not(".formset-custom-template"),e.val(l.length));for(var o=0,p=l.length;o<p;o++)j(l.eq(o),o),g.length||l.eq(o).find(h).each(function(){k(a(this),c.prefix,o)});return n()||a("a."+d).each(function(){a(this).hide()}),i.is(":hidden")&&m()&&i.show(),c.removed&&c.removed(b),!1})};if(i.each(function(b){var d=a(this),e=d.find('input:checkbox[id $= "-DELETE"]');e.length&&(e.is(":checked")?(e.before('<input type="hidden" name="'+e.attr("name")+'" id="'+e.attr("id")+'" value="on" />'),d.hide()):e.before('<input type="hidden" name="'+e.attr("name")+'" id="'+e.attr("id")+'" />'),a('label[for="'+e.attr("id")+'"]').hide(),e.remove()),l(d)&&(d.addClass(c.formCssClass),d.is(":visible")&&(o(d),j(d,b)))}),i.length){var q,r,p=!m();if(c.formTemplate?(r=c.formTemplate instanceof a?c.formTemplate:a(c.formTemplate),r.removeAttr("id").addClass(c.formCssClass+" formset-custom-template"),r.find(h).each(function(){k(a(this),c.prefix,"__prefix__")}),o(r)):(r=a("."+c.formCssClass+":last").clone(!0).removeAttr("id"),r.find('input:hidden[id $= "-DELETE"]').remove(),r.find(h).not(c.keepFieldValues).each(function(){var b=a(this);b.is("input:checkbox")||b.is("input:radio")?b.attr("checked",!1):b.val("")})),c.formTemplate=r,i.is("TR")){var s=i.eq(0).children().length,t=a('<tr><td colspan="'+s+'"><a class="'+c.addCssClass+'" href="javascript:void(0)">'+c.addText+"</a></tr>").addClass(c.formCssClass+"-add");i.parent().append(t),p&&t.hide(),q=t.find("a")}else i.filter(":last").after('<a class="'+c.addCssClass+'" href="javascript:void(0)">'+c.addText+"</a>"),q=i.filter(":last").next(),p&&q.hide();q.click(function(){var b=parseInt(e.val()),d=c.formTemplate.clone(!0).removeClass("formset-custom-template"),f=a(a(this).parents("tr."+c.formCssClass+"-add").get(0)||this);return delCssSelector=a.trim(c.deleteCssClass).replace(/\s+/g,"."),j(d,b),d.insertBefore(f).show(),d.find(h).each(function(){k(a(this),c.prefix,b)}),e.val(b+1),n()&&a("a."+delCssSelector).each(function(){a(this).show()}),m()||f.hide(),c.added&&c.added(d),!1})}return i},a.fn.formset.defaults={prefix:"form",formTemplate:null,addText:"add another",deleteText:"remove",addCssClass:"add-row",deleteCssClass:"delete-row",formCssClass:"dynamic-form",extraClasses:[],keepFieldValues:"",added:null,removed:null}}(jQuery);